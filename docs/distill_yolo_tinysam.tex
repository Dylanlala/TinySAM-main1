% LaTeX snippet: Losses and feature sizes for DINOv2â†’YOLOv11n distillation and YOLO+TinySAM pipeline

% --- Loss formulation ---
\paragraph{Overall Loss.}
\begin{equation}
L = L_{\mathrm{det}} + \lambda_f L_{\mathrm{feat}} + \lambda_a L_{\mathrm{att}} + \lambda_k L_{\mathrm{kl}}.
\end{equation}

\paragraph{Detection Loss.}
\begin{align}
L_{\mathrm{cls}} &= \frac{1}{N}\sum_{i=1}^{N}\mathrm{BCE}(p_i, y_i),\\
L_{\mathrm{obj}} &= \frac{1}{M}\sum_{j=1}^{M}\mathrm{BCE}(q_j, o_j),\\
L_{\mathrm{box}} &= \frac{1}{G}\sum_{g=1}^{G}\Big(1 - \mathrm{IoU}(b_g, \hat b_g) + \alpha v\Big),
\end{align}
with $v = \tfrac{4}{\pi^2}\big(\arctan\tfrac{w}{h}-\arctan\tfrac{\hat w}{\hat h}\big)^2$ and $\alpha = \tfrac{v}{(1-\mathrm{IoU})+v}$. The overall detection loss is
\begin{equation}
L_{\mathrm{det}} = \beta_{\mathrm{cls}}L_{\mathrm{cls}} + \beta_{\mathrm{obj}}L_{\mathrm{obj}} + \beta_{\mathrm{box}}L_{\mathrm{box}}.
\end{equation}

\paragraph{Feature Distillation.}
Let teacher features $T^{(l)}\in\mathbb{R}^{H_l\times W_l\times C_T}$ and student features $S^{(l)}\in\mathbb{R}^{H_l\times W_l\times C_S}$. A projection $P:\mathbb{R}^{C_S}\to\mathbb{R}^{C_T}$ aligns channels. We use
\begin{align}
L_{\mathrm{feat}}^{\mathrm{MSE}} &= \sum_{l\in\mathcal{L}} \tfrac{1}{H_lW_l}\lVert P(S^{(l)}) - T^{(l)} \rVert_2^2,\\
L_{\mathrm{feat}}^{\mathrm{cos}} &= \sum_{l\in\mathcal{L}} \tfrac{1}{H_lW_l}\sum_{x,y}\Big(1 - \cos\big(P(S^{(l)}_{x,y}), T^{(l)}_{x,y}\big)\Big).
\end{align}

\paragraph{Attention Transfer (optional).}
Define spatial attention via normalized channel energy:
\begin{align}
A_T^{(l)}(x,y) &= \frac{\sum_{c}(T_{x,y,c}^{(l)})^2}{\sum_{x',y',c}(T_{x',y',c}^{(l)})^2}, &
A_S^{(l)}(x,y) &= \frac{\sum_{c}(P(S_{x,y,c}^{(l)}))^2}{\sum_{x',y',c}(P(S_{x',y',c}^{(l)}))^2}.
\end{align}
Then
\begin{equation}
L_{\mathrm{att}} = \sum_{l\in\mathcal{L}} \lVert A_S^{(l)} - A_T^{(l)} \rVert_2^2.
\end{equation}

\paragraph{Logit Distillation (optional).}
With temperature $T$,
\begin{align}
p_T &= \mathrm{softmax}(z_T/T), & p_S &= \mathrm{softmax}(z_S/T),\\
L_{\mathrm{kl}} &= T^2\, \mathrm{KL}\big(p_T\,\|\,p_S\big) = T^2\sum_k p_T^{(k)}\log\frac{p_T^{(k)}}{p_S^{(k)}}.
\end{align}

% --- Feature size table ---
\paragraph{Feature Sizes.}
Assuming input $H\times W$ (e.g., $640\times640$):
\begin{center}
\begin{tabular}{lcccc}
\toprule
Module & Level & Spatial Size & Channels & Note \\
\midrule
YOLOv11n Backbone & C2 & $\tfrac{H}{4}\times\tfrac{W}{4}$ & $C_2$ & texture detail \\
YOLOv11n Backbone & C3 & $\tfrac{H}{8}\times\tfrac{W}{8}$ & $C_3$ & low-level semantics \\
YOLOv11n Backbone & C4 & $\tfrac{H}{16}\times\tfrac{W}{16}$ & $C_4$ & mid-level semantics \\
YOLOv11n Backbone & C5 & $\tfrac{H}{32}\times\tfrac{W}{32}$ & $C_5$ & high-level semantics \\
YOLOv11n Neck (PAFPN) & P3 & $\tfrac{H}{8}\times\tfrac{W}{8}$ & $P_3$ & fused \\
YOLOv11n Neck (PAFPN) & P4 & $\tfrac{H}{16}\times\tfrac{W}{16}$ & $P_4$ & fused \\
YOLOv11n Neck (PAFPN) & P5 & $\tfrac{H}{32}\times\tfrac{W}{32}$ & $P_5$ & fused \\
DINOv2 (ViT) & Patch tokens & $\tfrac{H}{p}\times\tfrac{W}{p}$ & $D_T$ & patch $p\in\{14,16\}$ \\
Projection & Proj(S$\to$T) & match student grid & $D_T$ & 1\,$\times$\,1 conv / MLP \\
\bottomrule
\end{tabular}
\end{center}

% --- Notes ---
\paragraph{Alignment.}
Spatial alignment uses bilinear interpolation between teacher token grid and student feature map. Channel alignment uses $P$ to map $C_S\to D_T$. Layerwise weighting $L_{\mathrm{feat}}=\sum_l w_l L_{\mathrm{feat}}^{(l)}$ is recommended.

% --- Hyper-parameters ---
\paragraph{Weights.}
Typical initial values: $\lambda_f\in[0.5,2.0]$, $\lambda_a\in[0.1,1.0]$, $\lambda_k\in[0.1,1.0]$.
