# DINOv2 内窥镜预训练配置文件

model:
  arch: 'vit_small'          # 模型架构: vit_small, vit_base, vit_large
  patch_size: 16             # patch大小
  img_size: 224              # 输入图像尺寸
  drop_path_rate: 0.1        # DropPath率
  
  # DINO配置
  dino:
    head_n_prototypes: 65536  # 原型数量
    head_bottleneck_dim: 256  # 瓶颈层维度
    head_nlayers: 3           # 头部层数
    head_hidden_dim: 2048     # 隐藏层维度
    teacher_temp: 0.04        # 教师温度
    student_temp: 0.1         # 学生温度
    center_momentum: 0.9      # 中心动量
  
  # iBOT配置
  ibot:
    mask_ratio_min_max: [0.1, 0.5]  # 掩码比例范围
    mask_sample_probability: 0.5     # 掩码采样概率
    head_n_prototypes: 65536         # 原型数量
    head_bottleneck_dim: 256         # 瓶颈层维度
    
data:
  train_path: '/home/huangmanling/TinySAM-main/Kvasir-SEG'  # 训练数据路径
  local_crops_size: 96       # 局部裁剪尺寸
  local_crops_number: 8      # 局部裁剪数量
  global_crops_scale: [0.4, 1.0]    # 全局裁剪缩放范围
  local_crops_scale: [0.05, 0.4]    # 局部裁剪缩放范围
  
  # 内窥镜专用数据增强
  augmentation:
    brightness: 0.3          # 亮度变化
    contrast: 0.3            # 对比度变化
    saturation: 0.2          # 饱和度变化
    hue: 0.1                 # 色调变化
    grayscale_prob: 0.1      # 灰度化概率
    gaussian_blur_prob: 0.8  # 高斯模糊概率
    solarize_prob: 0.2       # 日晒效应概率

training:
  epochs: 200                # 训练轮数
  batch_size: 32             # 批大小（根据GPU内存调整）
  lr: 1e-4                   # 学习率
  weight_decay: 0.05         # 权重衰减
  warmup_epochs: 10          # 预热轮数
  
  # 优化器配置
  optimizer: 'adamw'         # 优化器类型
  momentum: 0.9              # 动量（SGD用）
  
  # 学习率调度
  lr_scheduler: 'cosine'     # 学习率调度器
  min_lr: 1e-6               # 最小学习率
  
  # 训练设置
  num_workers: 8             # 数据加载线程数
  pin_memory: true           # 固定内存
  log_freq: 50               # 日志频率
  save_freq: 10              # 保存频率
  eval_freq: 20              # 评估频率

# 教师-学生配置
teacher:
  momentum: 0.996            # 教师动量更新
  final_momentum: 1.0        # 最终动量

# 输出配置
output_dir: 'dinov2_endoscopy_output'  # 输出目录
experiment_name: 'dinov2_endoscopy_vit_small'  # 实验名称

# 硬件配置
device: 'cuda'               # 设备
mixed_precision: true        # 混合精度训练
compile_model: false         # 模型编译（PyTorch 2.0+）

# 日志配置
logging:
  wandb: false               # 是否使用wandb
  tensorboard: true          # 是否使用tensorboard
  log_level: 'INFO'          # 日志级别